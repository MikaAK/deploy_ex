defmodule DeployEx.ReleaseUploader.UpdateValidator.MixDepsTreeParserTest do
  use ExUnit.Case, async: true

  alias DeployEx.ReleaseUploader.UpdateValidator.MixDepsTreeParser

  @cmd_output File.read!(Path.join(__DIR__, "./mix_deps_tree.txt"))

  describe "&parse_deps_tree/1" do
    test "parses the tree correctly" do
      output = MixDepsTreeParser.parse_deps_tree(@cmd_output)

      assert output === %{
        "assignment_marker" => [
          "con_cache",
          "error_message",
          "jason",
          "plug",
          "mime",
          "plug_crypto",
          "telemetry",
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "finch",
          "castore",
          "mint",
          "hpax",
          "nimble_options",
          "nimble_pool",
          "gen_stage",
          "learn_elixir_metrics",
          "prometheus_telemetry",
          "telemetry_metrics",
          "plug_cowboy",
          "cowboy",
          "cowlib",
          "ranch",
          "cowboy_telemetry",
          "telemetry_metrics_prometheus_core",
          "telemetry_poller",
          "shared_utils",
          "proper_case",
          "tzdata",
          "thinkific_api",
          "thinkific_session_scraper"
        ],
        "discord_bot" => [
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "jason",
          "shared_utils"
        ],
        "learn_elixir_lander" => [
          "con_cache",
          "credo",
          "bunt",
          "file_system",
          "jason",
          "dart_sass",
          "castore",
          "earmark",
          "earmark_parser",
          "ecto",
          "decimal",
          "telemetry",
          "error_message",
          "plug",
          "mime",
          "plug_crypto",
          "esbuild",
          "ex_aws",
          "hackney",
          "sweet_xml",
          "ex_aws_s3",
          "excoveralls",
          "faker",
          "finch",
          "mint",
          "hpax",
          "nimble_options",
          "nimble_pool",
          "floki",
          "html_entities",
          "gen_smtp",
          "ranch",
          "gettext",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "learn_elixir_mailer",
          "swoosh",
          "mailchimp",
          "httpoison",
          "phoenix",
          "phoenix_pubsub",
          "phoenix_view",
          "phoenix_html",
          "plug_cowboy",
          "phoenix_ecto",
          "phoenix_live_dashboard",
          "phoenix_live_view",
          "telemetry_metrics",
          "phoenix_live_reload",
          "cowboy",
          "cowlib",
          "cowboy_telemetry",
          "postgrex",
          "connection",
          "db_connection",
          "pot",
          "shared_utils",
          "proper_case",
          "tzdata",
          "short_linker",
          "tailwind",
          "telemetry_poller",
          "timex",
          "combine"
        ],
        "learn_elixir_mailer" => [
          "finch",
          "castore",
          "mime",
          "mint",
          "hpax",
          "nimble_options",
          "nimble_pool",
          "telemetry",
          "swoosh"
        ],
        "learn_elixir_metrics" => [
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "jason",
          "prometheus_telemetry",
          "nimble_options",
          "plug",
          "mime",
          "plug_crypto",
          "telemetry",
          "plug_cowboy",
          "cowboy",
          "cowlib",
          "ranch",
          "cowboy_telemetry",
          "telemetry_metrics",
          "telemetry_metrics_prometheus_core",
          "telemetry_poller"
        ],
        "learn_elixir_tasks" => [
          "discord_bot",
          "shared_utils",
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "jason",
          "error_message",
          "plug",
          "mime",
          "plug_crypto",
          "telemetry",
          "finch",
          "castore",
          "mint",
          "hpax",
          "nimble_options",
          "nimble_pool",
          "proper_case",
          "tzdata",
          "thinkific_api",
          "thinkific_session_scraper"
        ],
        "shared_utils" => [
          "error_message",
          "jason",
          "plug",
          "mime",
          "plug_crypto",
          "telemetry",
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "finch",
          "castore",
          "mint",
          "hpax",
          "nimble_options",
          "nimble_pool",
          "proper_case",
          "tzdata"
        ],
        "short_linker" => [
          "credo",
          "bunt",
          "file_system",
          "jason",
          "error_message",
          "plug",
          "mime",
          "plug_crypto",
          "telemetry",
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "shared_utils"
        ],
        "thinkific_api" => [
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "jason",
          "shared_utils"
        ],
        "thinkific_session_scraper" => [
          "error_message",
          "jason",
          "plug",
          "mime",
          "plug_crypto",
          "telemetry",
          "excoveralls",
          "hackney",
          "certifi",
          "idna",
          "unicode_util_compat",
          "metrics",
          "mimerl",
          "parse_trans",
          "ssl_verify_fun",
          "hound",
          "shared_utils"
        ]
      }
    end
  end
end
